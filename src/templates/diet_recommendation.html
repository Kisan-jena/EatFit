{% extends "base.html" %}

{% block title %}Diet Recommendations{% endblock %}
{% block header_title %}Personalized Diet Recommendations{% endblock %}

{% block extra_css %}
<style>
    /* Diet Recommendation Page Styling */
    .recommendation-card {
        border-radius: 20px;
        overflow: hidden;
        transition: all 0.4s ease;
        margin-bottom: 2rem;
    }
    
    .recommendation-header {
        position: relative;
        padding: 2rem;
        border-radius: 20px 20px 0 0;
        background: linear-gradient(135deg, #43cea2, #185a9d);
        color: white;
    }
    
    .diet-profile-form {
        background-color: white;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        padding: 2rem;
        margin-bottom: 2rem;
    }
    
    .diet-profile-tabs {
        display: flex;
        overflow-x: auto;
        margin-bottom: 2rem;
        border-bottom: 1px solid #e9ecef;
    }
    
    .diet-profile-tab {
        padding: 1rem 1.5rem;
        border-bottom: 3px solid transparent;
        font-weight: 500;
        color: var(--secondary-color);
        cursor: pointer;
        white-space: nowrap;
    }
    
    .diet-profile-tab.active {
        color: var(--primary-color);
        border-bottom-color: var(--primary-color);
    }
    
    .diet-section {
        margin-bottom: 2rem;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        background-color: white;
    }
    
    .diet-section-header {
        padding: 1rem 1.5rem;
        background-color: #f8f9fa;
        border-bottom: 2px solid #e9ecef;
        font-weight: 600;
        display: flex;
        align-items: center;
    }
    
    .diet-section-header i {
        margin-right: 0.5rem;
        font-size: 1.25rem;
        color: #43cea2;
    }
    
    .diet-section-content {
        padding: 1.5rem;
    }
    
    .meal-plan {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-top: 1rem;
    }
    
    .meal-card {
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
    }
    
    .meal-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    .meal-card-header {
        padding: 1rem;
        background-color: #f8f9fa;
        border-bottom: 1px solid #e9ecef;
    }
    
    .meal-card-content {
        padding: 1.5rem;
    }
    
    .meal-card-content ul {
        padding-left: 1.5rem;
        margin-bottom: 0;
    }
    
    .meal-card-content li {
        margin-bottom: 0.5rem;
    }
    
    .diet-tips {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-top: 1rem;
    }
    
    .tip-card {
        background-color: #f8f9fa;
        border-radius: 15px;
        padding: 1.5rem;
        border-left: 4px solid var(--primary-color);
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    }
    
    .tip-card h5 {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
        color: var(--primary-color);
    }
    
    .tip-card h5 i {
        margin-right: 0.5rem;
    }
    
    /* Animated elements */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-fade-in {
        animation: fadeIn 0.5s ease-out forwards;
    }
    
    .delay-1 { animation-delay: 0.1s; }
    .delay-2 { animation-delay: 0.2s; }
    .delay-3 { animation-delay: 0.3s; }
    .delay-4 { animation-delay: 0.4s; }
    
    /* Progress wheel */
    .progress-wheel {
        width: 120px;
        height: 120px;
        position: relative;
        margin: 0 auto;
    }
    
    .progress-circle {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: conic-gradient(var(--primary-color) 0% 70%, #e9ecef 70% 100%);
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .progress-circle::before {
        content: "";
        position: absolute;
        width: 80%;
        height: 80%;
        border-radius: 50%;
        background-color: white;
    }
    
    .progress-value {
        position: relative;
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary-color);
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .meal-plan, .diet-tips {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="recommendation-card animate-fade-in">
    <div class="recommendation-header">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1>Your Diet Recommendation</h1>
                <p class="mb-0">Personalized nutrition plan based on your profile and medical conditions</p>
            </div>
            <div class="col-md-4 text-md-end">
                <span class="badge bg-light text-dark rounded-pill fs-6 px-3 py-2">
                    <i class="bi bi-calendar-check me-1"></i> Updated: Today
                </span>
            </div>
        </div>
    </div>
    
    <div class="diet-profile-form animate-fade-in delay-1">
        <h4 class="mb-4">Your Diet Profile</h4>
        
        <div class="diet-profile-tabs">
            <div class="diet-profile-tab active" data-tab="basic-information">Basic Information</div>
            <div class="diet-profile-tab" data-tab="medical-conditions">Medical Conditions</div>
        </div>
        
        <form id="dietProfileForm" method="post" action="{{ url_for('diet.update_diet_recommendation') }}">
            <!-- Basic Information Tab Content (visible by default) -->
            <div class="tab-content" id="basic-information-tab">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="age" class="form-label">Age</label>
                        <input type="text" class="form-control" id="age" name="age" value="{{ user_profile.age|default(30) }}" readonly>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Height</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="height" name="height" value="{{ user_profile.height|default(5.0) }}" readonly>
                            <span class="input-group-text">ft</span>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="weight" class="form-label">Weight (kg)</label>
                        <input type="text" class="form-control" id="weight" name="weight" value="{{ user_profile.weight|default(65) }}" readonly>
                    </div>
                </div>

                <div class="text-muted mb-3">
                    <p class="small mb-0">BMI: <span id="bmi-value">{{ user_profile.bmi }}</span></p>
                    <p class="small mb-0">BMI Category: <span>{{ diet_plan.bmi_category|default('Normal weight') }}</span></p>
                </div>
            </div>

            <!-- Medical Conditions Tab Content (hidden by default) -->
            <div class="tab-content" id="medical-conditions-tab" style="display: none;">
                <h5 class="mb-3">Medical Conditions</h5>
                <p class="text-muted small mb-3">Select any conditions that apply to you. This will help us tailor your diet recommendations.</p>
                
                <div class="row">
                    <div class="col-md-6 mb-2">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="diabetes" name="diseases[]" value="diabetes" {% if 'diabetes' in user_profile.diseases %}checked{% endif %}>
                            <label class="form-check-label" for="diabetes">Diabetes</label>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="hypertension" name="diseases[]" value="hypertension" {% if 'hypertension' in user_profile.diseases %}checked{% endif %}>
                            <label class="form-check-label" for="hypertension">Hypertension</label>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="heart_disease" name="diseases[]" value="heart disease" {% if 'heart disease' in user_profile.diseases %}checked{% endif %}>
                            <label class="form-check-label" for="heart_disease">Heart Disease</label>
                        </div>
                    </div>
                    <div class="col-md-6 mb-2">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="obesity" name="diseases[]" value="obesity" {% if 'obese' in user_profile.diseases or 'obesity' in user_profile.diseases %}checked{% endif %}>
                            <label class="form-check-label" for="obesity">Obesity</label>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3 mt-3">
                    <label for="other_conditions" class="form-label">Other Conditions</label>
                    <textarea class="form-control" id="other_conditions" name="other_conditions" rows="2" placeholder="Please specify any other medical conditions...">{{ user_profile.other_conditions|default('') }}</textarea>
                </div>
            </div>
            
            <div class="text-end">
                <button type="submit" class="btn btn-primary">Update Recommendation</button>
            </div>
        </form>
    </div>
    
    <div class="row">
        <div class="col-lg-4 animate-fade-in delay-2">
            <div class="diet-section">
                <div class="diet-section-header">
                    <i class="bi bi-pie-chart-fill"></i>
                    <span>Calorie Needs</span>
                </div>
                <div class="diet-section-content text-center">
                    <div class="progress-wheel mb-4">
                        <div class="progress-circle" style="background: conic-gradient(var(--primary-color) 0% 70%, #e9ecef 70% 100%);">
                            <span class="progress-value">{{ diet_plan.daily_calories|default(1800) }}</span>
                        </div>
                    </div>
                    <h5>Daily Calories</h5>
                    <p class="text-muted">Based on your age, weight, and height</p>
                </div>
            </div>

            {% if user_profile.diseases %}
            <div class="diet-section mt-3">
                <div class="diet-section-header">
                    <i class="bi bi-heart-pulse"></i>
                    <span>Medical Conditions</span>
                </div>
                <div class="diet-section-content">
                    <ul class="list-group list-group-flush">
                        {% for disease in user_profile.diseases %}
                        <li class="list-group-item bg-transparent d-flex align-items-center">
                            <i class="bi bi-check-circle-fill text-success me-2"></i>
                            <div>
                                <h6 class="mb-0">{{ disease|capitalize }}</h6>
                                <p class="small text-muted mb-0">Diet adjusted accordingly</p>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
        </div>
        
        <div class="col-lg-8 animate-fade-in delay-3">
            <div class="diet-section">
                <div class="diet-section-header">
                    <i class="bi bi-calendar-week"></i>
                    <span>Recommended Meal Plan</span>
                </div>
                <div class="diet-section-content">
                    <div class="meal-plan">
                        <div class="meal-card mb-4">
                            <div class="meal-card-header">
                                <h4>Breakfast</h4>
                                <a href="{{ url_for('diet.meal_alternatives', meal_type='breakfast') }}" class="btn btn-primary">View Breakfast Alternatives</a>
                            </div>
                            <div class="meal-card-content">
                                <ul>
                                    {% if diet_plan.breakfast %}
                                        {% for item in diet_plan.breakfast %}
                                        <li>{{ item }}</li>
                                        {% endfor %}
                                    {% else %}
                                        <li>Oatmeal with berries (1 cup)</li>
                                        <li>Greek yogurt (1/2 cup)</li>
                                        <li>Mixed nuts (1/4 cup)</li>
                                        <li>Green tea or water</li>
                                    {% endif %}
                                </ul>
                                <div class="mt-3 d-flex justify-content-between">
                                    <small class="text-muted">{{ diet_plan.daily_calories|default(1800) // 4 }} calories</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="meal-card mb-4">
                            <div class="meal-card-header">
                                <h4>Lunch</h4>
                                <a href="{{ url_for('diet.meal_alternatives', meal_type='lunch') }}" class="btn btn-primary">View Lunch Alternatives</a>
                            </div>
                            <div class="meal-card-content">
                                <ul>
                                    {% if diet_plan.lunch %}
                                        {% for item in diet_plan.lunch %}
                                        <li>{{ item }}</li>
                                        {% endfor %}
                                    {% else %}
                                        <li>Grilled chicken salad</li>
                                        <li>Whole grain bread (1 slice)</li>
                                        <li>Olive oil dressing (1 tbsp)</li>
                                        <li>Fresh fruit</li>
                                    {% endif %}
                                </ul>
                                <div class="mt-3 d-flex justify-content-between">
                                    <small class="text-muted">{{ diet_plan.daily_calories|default(1800) // 3 }} calories</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="meal-card mb-4">
                            <div class="meal-card-header">
                                <h4>Dinner</h4>
                                <a href="{{ url_for('diet.meal_alternatives', meal_type='dinner') }}" class="btn btn-primary">View Dinner Alternatives</a>
                            </div>
                            <div class="meal-card-content">
                                <ul>
                                    {% if diet_plan.dinner %}
                                        {% for item in diet_plan.dinner %}
                                        <li>{{ item }}</li>
                                        {% endfor %}
                                    {% else %}
                                        <li>Baked salmon (4 oz)</li>
                                        <li>Steamed vegetables (1 cup)</li>
                                        <li>Brown rice (1/2 cup)</li>
                                        <li>Lemon water</li>
                                    {% endif %}
                                </ul>
                                <div class="mt-3 d-flex justify-content-between">
                                    <small class="text-muted">{{ diet_plan.daily_calories|default(1800) // 3 }} calories</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="diet-section animate-fade-in delay-4">
        <div class="diet-section-header">
            <i class="bi bi-lightbulb"></i>
            <span>General Diet Tips</span>
        </div>
        <div class="diet-section-content">
            <div class="diet-tips">
                <div class="tip-card">
                    <h5><i class="bi bi-cup-hot"></i> Hydration</h5>
                    <p>Aim to drink at least 2 liters of water daily. Limit sugary drinks and alcohol.</p>
                </div>
                
                <div class="tip-card">
                    <h5><i class="bi bi-alarm"></i> Meal Timing</h5>
                    <p>Try to eat at regular intervals and avoid large meals close to bedtime.</p>
                </div>
                
                <div class="tip-card">
                    <h5><i class="bi bi-heart-pulse"></i> Heart Health</h5>
                    <p>Include omega-3 rich foods like fish, walnuts, and flaxseeds in your diet.</p>
                </div>
                
                <div class="tip-card">
                    <h5><i class="bi bi-battery-half"></i> Portion Control</h5>
                    <p>Be mindful of portion sizes to help maintain your calorie target.</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Tab switching functionality
        const tabs = document.querySelectorAll('.diet-profile-tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                tabs.forEach(t => t.classList.remove('active'));
                
                // Add active class to clicked tab
                this.classList.add('active');
                
                // Hide all tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.style.display = 'none';
                });
                
                // Show the corresponding tab content
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId + '-tab').style.display = 'block';
            });
        });
        
        // Show initial tab content
        document.getElementById('basic-information-tab').style.display = 'block';
        
        // BMI calculation
        function calculateBMI() {
            const heightInput = document.getElementById('height');
            const weightInput = document.getElementById('weight');
            const bmiValue = document.getElementById('bmi-value');
            
            if (!heightInput || !weightInput || !bmiValue) {
                return;
            }
            
            const heightDecimal = parseFloat(heightInput.value) || 0;
            const weight = parseFloat(weightInput.value) || 0;
            
            if (heightDecimal === 0 || weight === 0) {
                return;
            }
            
            // Convert decimal feet height to meters for BMI calculation
            const feet = Math.floor(heightDecimal);
            const inches = (heightDecimal - feet) * 12;
            const totalInches = (feet * 12) + inches;
            const heightMeters = totalInches * 0.0254;
            
            // Calculate BMI
            const bmi = weight / (heightMeters * heightMeters);
            bmiValue.textContent = bmi;
        }
        
        // Calculate BMI on page load if height and weight have values
        calculateBMI();
        
        // Add event listeners for height and weight inputs
        const heightInput = document.getElementById('height');
        if (heightInput) {
            heightInput.addEventListener('input', calculateBMI);
        }
        
        const weightInput = document.getElementById('weight');
        if (weightInput) {
            weightInput.addEventListener('input', calculateBMI);
        }
    });
</script>
{% endblock %} 
